<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>大学フロアマップ表示（GeoJSON + Leaflet + 部屋ハイライト）</title>
    <!-- Leaflet の CSS を読み込む -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      /* ページ全体の余白をリセット */
      body,
      html {
        margin: 0;
        padding: 0;
        height: 100%;
        background: #fff; /* 背景色を白に */
      }
      /* 地図表示領域を全画面に */
      #map {
        width: 100%;
        height: 100%;
        background: #fff; /* 背景色を白に */
      }
    </style>
  </head>
  <body>
    <!-- 地図を描画するための div -->
    <div id="map"></div>

    <!-- Leaflet の JS を読み込む -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      // ──────────────────────────────
      // 1. GeoJSON データ定義
      //    先ほどの回答で示した「大学のフロアマップ」を GeoJSON フォーマットで定義します。
      //    必要があれば座標を実測値に合わせて修正してください。
      // ──────────────────────────────
      const floorMapData = {
        type: "FeatureCollection",
        crs: { type: "name", properties: { name: "CRS:PIXEL" } },
        features: [
          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [780, -120],
                  [780, 390],

                  [550, 390],
                  [550, 840],
                  [80, 840],
                  [80, 920],
                  [780, 920],
                  [780, 1220],
                  [839, 1220],
                  [841, -120],
                ],
              ],
            },
            properties: {
              id: "190",
              name: "190",
              type: "Hallway",
              area: 354190,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [650, 930],
                  [770, 930],
                  [770, 1220],
                  [650, 1220],
                  [650, 930],
                ],
              ],
            },
            properties: {
              id: "198",
              name: "198",
              type: "stair",
              area: 33861,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [460, 930],
                  [640, 930],
                  [640, 1220],
                  [460, 1220],
                  [460, 930],
                ],
              ],
            },
            properties: {
              id: "104",
              name: "104",
              type: "room",
              area: 51433,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [210, 930],
                  [450, 930],
                  [450, 1220],
                  [210, 1220],
                  [210, 930],
                ],
              ],
            },
            properties: {
              id: "105",
              name: "105",
              type: "room",
              area: 67544,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [80, 930],
                  [200, 930],
                  [200, 1220],
                  [80, 1220],
                  [80, 930],
                ],
              ],
            },
            properties: {
              id: "103",
              name: "103",
              type: "room",
              area: 33388,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [1090, 690],
                  [1090, 910],
                  [850, 910],
                  [850, 690],
                ],
              ],
            },
            properties: {
              id: "106",
              name: "106",
              type: "room",
              area: 72050,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [850, 390],
                  [1090, 390],
                  [1090, 680],
                  [850, 680],
                  [850, 540],
                ],
              ],
            },
            properties: {
              id: "107",
              name: "107",
              type: "room",
              area: 35691,
            },
          },


          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [630, 450],
                  [770, 450],
                  [770, 870],
                  [630, 870],
                ],
              ],
            },
            properties: {
              id: "191",
              name: "191",
              type: "room",
              area: 94347,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [80, 490],
                  [540, 490],
                  [540, 830],
                  [80, 830],
                ],
              ],
            },
            properties: {
              id: "102",
              name: "102",
              type: "room",
              area: 73746,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [540, 90],
                  [540, 480],
                  [80, 480],
                  [80, 90],
                ],
              ],
            },
            properties: {
              id: "101",
              name: "101",
              type: "room",
              area: 33763,
            },
          },
          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [550, 90],
                  [640, 90],
                  [640, 380],
                  [550, 380],

                ],
              ],
            },
            properties: {
              id: "110",
              name: "110",
              type: "room",
              area: 51855,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [650, 90],
                  [770, 90],
                  [770, 380],
                  [650, 380],
                  [650, 90],
                ],
              ],
            },
            properties: {
              id: "197",
              name: "197",
              type: "stair",
              area: 33729,
              highlight: true,
            },
          },

          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [770, -120],
                  [770, 80],
                  [600, 80],
                  [600, -120],
                ],
              ],
            },
            properties: {
              id: "196",
              name: "196",
              type: "toilet",
              area: 33729,
              highlight: true,
            },
          },
          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [850, 90],
                  [1090, 90],
                  [1090, 380],
                  [850, 380],
                  [850, 90],
                ],
              ],
            },
            properties: {
              id: "108",
              name: "108",
              type: "room",
              area: 72292,
            },
          },
          {
            type: "Feature",
            geometry: {
              type: "Polygon",
              coordinates: [
                [
                  [1090, 80],
                  [1090, -120],
                  [850, -120],
                  [850, 80],
                ],
              ],
            },
            properties: {
              id: "109",
              name: "109",
              type: "room",
              area: 72292,
            },
          },
          
        ],
      };

      // ──────────────────────────────
      // 2. Leaflet マップを初期化
      //    CRS.Simple を使って「緯度経度ではなく任意の平面座標」を扱います。
      // ──────────────────────────────
      const map = L.map("map", {
        crs: L.CRS.Simple,
        attributionControl: false,
        minZoom: -2,
      });

      // ──────────────────────────────
      // 3. GeoJSON を読み込んでスタイル・ポップアップを設定
      // ──────────────────────────────
      //    各フィーチャの type に応じて初期スタイルを決定
      function getInitialStyle(feature) {
        switch (feature.properties.type) {
          case "room":
            return {
              color: "#333333",
              weight: 1,
              fillColor: "#cccccc",
              fillOpacity: 0.3,
            };
          case "hall":
            return {
              color: "#555555",
              weight: 1,
              fillColor: "#dddddd",
              fillOpacity: 0.2,
            };
          case "corridor":
            return {
              color: "#999999",
              weight: 1,
              fillColor: "#eeeeee",
              fillOpacity: 0.1,
            };
          case "facility":
            return {
              color: "#b22222",
              weight: 1,
              fillColor: "#f4a7a7",
              fillOpacity: 0.4,
            };
          default:
            return {
              color: "#000000",
              weight: 1,
              fillColor: "#ffffff",
              fillOpacity: 0.1,
            };
        }
      }

      let highlightedLayer = null; // 現在ハイライト中の L.Layer を保持

      const floorLayer = L.geoJSON(floorMapData, {
        style: getInitialStyle,
        onEachFeature: (feature, layer) => {
          // ポップアップに部屋名や設備名を表示
          if (feature.properties.name) {
            layer.bindPopup(
              `<b>${feature.properties.name}</b><br>Type: ${feature.properties.type}`
            );
          }
        },
      }).addTo(map);

      // ──────────────────────────────
      // 4. 地図の表示範囲を GeoJSON の境界に合わせて調整
      // ──────────────────────────────
      const bounds = floorLayer.getBounds();
      map.fitBounds(bounds, { padding: [20, 20] });
    </script>
  </body>
</html>
